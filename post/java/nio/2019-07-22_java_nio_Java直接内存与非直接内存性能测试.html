<!DOCTYPE html>
<html lang="zh-CN">

<!-- Head tag -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="referrer" content="no-referrer-when-downgrade">
  
  <meta name="baidu-site-verification" content="" />
  <meta name="google-site-verification" content="" />
  <meta name="msvalidate.01" content="" />
  <meta name="360-site-verification" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- if page has tags, then add tags to keyword -->
  
  
  <meta name="keywords" content=",Java,NIO,直接内存,非直接内存,堆内存,">
  <!-- page.description has higher priority -->
  <meta name="description" content="Share everything">
  <link rel="shortcut icon" href="/favico.png">
  <title>
    
    Java直接内存与非直接内存性能测试 | 分享之
    
  </title>

  <link rel="canonical" href="/post/java/nio/2019-07-22_java_nio_Java直接内存与非直接内存性能测试.html">
  
<link rel="stylesheet" href="/css/reset.css">

  
<link rel="stylesheet" href="/css/layout.css">

  
<link rel="stylesheet" href="/css/markdown.css">

  <!-- Pygments Highlight CSS -->
  
<link rel="stylesheet" href="/css/highlight.css">

  
<link rel="stylesheet" href="/css/geektutu.css">

  <!-- global function -->
  <script>
    window.globalAddScript = function (url, onload, onerror) {
      var s = document.createElement('script');
      s.src = url;
      onload && (s.onload = onload);
      onerror && (s.onerror = onerror);
      document.body.appendChild(s);
    }
    window.globalAddCss = function (url) {
      var s = document.createElement('link');
      s.rel = 'stylesheet';
      s.href = url;
      document.body.appendChild(s);
    }
    window.getPosition = function (ele) {
      var x = 0, y = 0;
      while (ele) {
        x += (ele.offsetLeft - ele.scrollLeft + ele.clientLeft);
        y += (ele.offsetTop - ele.scrollTop + ele.clientTop);
        ele = ele.offsetParent;
      }
      return { x: x, y: y };
    }
    window.getDom = function (str) { return document.querySelector(str) }
  </script>
  <!-- google ad -->
  
<meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/feed.xml" title="分享之" type="application/rss+xml">
</head>

<body>
    <header class="gkt-header col-xs-12 padding-0">
    <div id="gkt-nav" class="gkt-header-container">
        <a href="/" class="gkt-header-title float-left">
            <img class="float-left" src="/favico.png" alt="">
            <span>分享之</span>
        </a>
        <nav class="gkt-header-nav text-right">
            <ul>
                <li><a class="hidden-xs" href="/feed.xml">订阅</a></li>
                <li><a href="/series/">专题</a></li>
                <li><a href="/archives/">归档</a></li>
                <li><a href="/post/link.html">友链</a></li>
                <li><a href="/post/about.html">关于</a></li>
            </ul>
        </nav>
    </div>
    <div id="gkt-cate-nav" class="gkt-header-container hidden-xs">
        
        <nav class="gkt-header-nav float-left">
            <ul>
                
                
                <li class="gkt-cate-name float-left active">
                    <a class="float-left" href="/post/java/basic/2016-10-25_hashmap_jdk7.html">Java ▾</a>
                    
                    <ul class="gkt-sub-cate">
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/java/basic/2016-10-25_hashmap_jdk7.html">Java 基础</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/java/advance/2016-10-25_number.html">Java 进阶</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/java/io/2017-04-15_java_io_1_overview.html">Java IO</a></li>
                        
                        <li class="gkt-sub-cate-name active"><a class="float-left"
                                href="/post/java/nio/2017-04-21_java_nio_1.html">Java NIO</a></li>
                        
                    </ul>
                    
                </li>
                
                <li class="gkt-cate-name float-left ">
                    <a class="float-left" href="/post/java/spring/2016-10-30_Spring 组合注解&amp;注解继承.html">Spring ▾</a>
                    
                    <ul class="gkt-sub-cate">
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/java/spring/2016-10-30_Spring 组合注解&amp;注解继承.html">Spring Core</a></li>
                        
                        <li class="gkt-sub-cate-name "><a class="float-left"
                                href="/post/java/spring/2019-12-28_【译】Spring Boot 从 classpath 加载文件.html">Spring Boot</a></li>
                        
                    </ul>
                    
                </li>
                
                <li class="gkt-cate-name float-left ">
                    <a class="float-left" href="/post/util/2017-10-25_idea_shotcut.html">开发工具</a>
                    
                </li>
                
                <li class="gkt-cate-name float-left ">
                    <a class="float-left" href="/post/java/netty/2019-01-02_小白科普：Netty有什么用？.html">Java 框架</a>
                    
                </li>
                
                <li class="gkt-cate-name float-left ">
                    <a class="float-left" href="/post/algorithm/八皇后算法解析.html">算法</a>
                    
                </li>
                
            </ul>
        </nav>
    </div>
</header>
<div class="gkt-header-placeholder" style="height: 44px"></div>
<div class="gkt-header-placeholder hidden-xs" style="height: 44px"></div>
<script>
    (function () {
        window.addEventListener('scroll', function () {
            if (window.innerWidth < 768) {
                return;
            }
            var nav = document.querySelector('#gkt-nav');
            var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
            scrollTop > 50 && (nav.classList.add('hide'));
            scrollTop <= 50 && (nav.classList.remove('hide'));
        });
        var cateNavs = document.querySelectorAll('#gkt-cate-nav>nav>ul>li');
        [].slice.call(cateNavs).forEach(function (item) {
            var sub = item.querySelector('.gkt-sub-cate');
            if (!sub) return;
            item.addEventListener('mouseenter', function (e) { sub.style.display = 'block'; }, false);
            item.addEventListener('mouseleave', function (e) { sub.style.display = 'none'; }, false);
        })
    })();
</script>
    <!-- Main Content -->
    <div class="main-container">
        <!-- Main Content -->
<main class="col-xs-12 padding-0 markdown-it">
    <!-- Post Container -->
    
    
    <!-- Post Content -->
<div class="float-left post-container box-shadow">
    <div class="u-arrow-wrapper hidden-xs">
        
        <a class="float-left" href="/post/java/advance/2019-05-04_java_labmda.html"><i class="u-arrow-left"></i></a>
        
        
        <a class="float-right" href="/post/java/advance/2019-07-22_java_stack.html"><i class="u-arrow-right"></i></a>
        
    </div>
    <article class="col-xs-12">
        <h1> Java直接内存与非直接内存性能测试 </h1>
        
        
        <div class="hidden-lg hidden-md series_links">
            <p> <strong> Java NIO系列文章链接：</strong></p>
            <ul>
                
                <li>
                    <a href="/post/java/nio/2017-04-21_java_nio_1.html">Java NIO (1) 基本概念</a>
                    <span class="post-item-date">(Apr 21, 2017)</span>
                </li>
                
                <li>
                    <a href="/post/java/nio/2017-04-22_java_nio_2.html">Java NIO(2) Buffer</a>
                    <span class="post-item-date">(Apr 22, 2017)</span>
                </li>
                
                <li>
                    <a href="/post/java/nio/2017-04-23_java_nio_3.html">Java NIO(3) 选择器 Selector</a>
                    <span class="post-item-date">(Apr 23, 2017)</span>
                </li>
                
                <li>
                    <a href="/post/java/nio/2019-02-27_java_nio_model.html">谈一谈 Java IO 模型</a>
                    <span class="post-item-date">(Feb 27, 2019)</span>
                </li>
                
                <li>
                    <a href="/post/java/nio/2019-04-07_java_nio_debug.html">Java NIO客户端主动关闭连接，导致服务器空轮询</a>
                    <span class="post-item-date">(Apr 7, 2019)</span>
                </li>
                
                <li>
                    <a href="/post/java/nio/2019-04-07_java_nio_使用注意点.html">NIO 各种使用注意点</a>
                    <span class="post-item-date">(Apr 7, 2019)</span>
                </li>
                
                <li>
                    <a href="/post/java/nio/2019-07-22_java_nio_Java直接内存与非直接内存性能测试.html">Java直接内存与非直接内存性能测试</a>
                    <span class="post-item-date">(Jul 22, 2019)</span>
                </li>
                
            </ul>
        </div>
        
        
        <h2 id="什么是直接内存与非直接内存"><a href="#什么是直接内存与非直接内存" class="headerlink" title="什么是直接内存与非直接内存"></a>什么是直接内存与非直接内存</h2><p>根据官方文档的描述：</p>
<blockquote>
<p>A byte bufferis either direct or non-direct. Given a direct byte buffer, the Java virtual machine will make a best effort to perform native I/O operations directly upon it. That is, it will attempt to avoid copying the buffer’s content to (or from) an intermediate buffer before (orafter) each invocation of one of the underlying operating system’s native I/O operations.</p>
</blockquote>
<p><code>byte byffer</code>可以是两种类型，一种是基于直接内存（也就是非堆内存）；另一种是非直接内存（也就是堆内存）。</p>
<p>对于直接内存来说，JVM将会在IO操作上具有更高的性能，因为它直接作用于本地系统的IO操作。而非直接内存，也就是堆内存中的数据，如果要作IO操作，会先复制到直接内存，再利用本地IO处理。</p>
<p>从数据流的角度，非直接内存是下面这样的作用链：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">本地IO--&gt;直接内存--&gt;非直接内存--&gt;直接内存--&gt;本地IO</span><br></pre></td></tr></table></figure>

<p>而直接内存是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">本地IO--&gt;直接内存--&gt;本地IO</span><br></pre></td></tr></table></figure>

<p>很明显，再做IO处理时，比如网络发送大量数据时，直接内存会具有更高的效率。</p>
<blockquote>
<p>A direct byte buffer may be created by invoking the allocateDirect factory method of this class. The buffers returned by this method typically have somewhat higher allocation and deallocation costs than non-direct buffers. The contents of direct buffers may reside outside of the normal garbage-collected heap, and so their impact upon the memory footprint of an application might not be obvious. It is therefore recommended that direct buffers be allocated primarily for large, long-lived buffers that are subject to the underlying system’s native I/O operations. In general it is best to allocate direct buffers only when they yield a measureable gain in program performance.</p>
</blockquote>
<p>但是，不要高兴的太早。文档中也说了，直接内存使用allocateDirect创建，但是它比申请普通的堆内存需要耗费更高的性能。不过，这部分的数据是在JVM之外的，因此它不会占用应用的内存。</p>
<p>所以呢，当你有很大的数据要缓存，并且它的生命周期又很长，那么就比较适合使用直接内存。只是一般来说，如果不是能带来很明显的性能提升，还是推荐直接使用堆内存。</p>
<p>关于直接内存需要注意的，就是上面两点了，其他的关于视图啊、作用链啊，都是使用上的问题了。如果有兴趣，可以<a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/">参考官方API ( 进去后搜索ByteBuffer，就能看到！)</a>，里面有少量的描述！重要的一些用法，还得自己摸索。</p>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>通过上面的官方文档，与一些资料的搜索。可以总结下，直接内存的使用场景：</p>
<ul>
<li>1 有很大的数据需要存储，它的生命周期又很长</li>
<li>2 适合频繁的IO操作，比如网络并发场景</li>
</ul>
<h2 id="申请分配地址速度比较"><a href="#申请分配地址速度比较" class="headerlink" title="申请分配地址速度比较"></a>申请分配地址速度比较</h2><p>下面用一段简单的代码，测试下申请内存空间的速度：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">inttime &#x3D; 10000000;</span><br><span class="line">Date begin &#x3D; newDate();</span><br><span class="line">for(int i&#x3D;0;i&lt;time;i++)&#123;</span><br><span class="line">    ByteBuffer buffer &#x3D; ByteBuffer.allocate(2);</span><br><span class="line">&#125;</span><br><span class="line">Dateend &#x3D; newDate();</span><br><span class="line">System.out.println(end.getTime()-begin.getTime());</span><br><span class="line">begin &#x3D; newDate();</span><br><span class="line">for(int i&#x3D;0;i&lt;time;i++)&#123;</span><br><span class="line">    ByteBuffer buffer &#x3D; ByteBuffer.allocateDirect(2);</span><br><span class="line">&#125;</span><br><span class="line">end &#x3D; newDate();</span><br><span class="line">System.out.println(end.getTime()-begin.getTime());</span><br></pre></td></tr></table></figure>

<p>得到的测试结果如下：</p>
<p><img src="./2019-07-22_java_nio_Java%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98%E4%B8%8E%E9%9D%9E%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/1.png"></p>
<p>在数据量提升时，直接内存相比于非直接内存的申请 有十分十分十分明显的性能问题！</p>
<h2 id="读写速度比较"><a href="#读写速度比较" class="headerlink" title="读写速度比较"></a>读写速度比较</h2><p>然后在写段代码，测试下读写的速度：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">inttime &#x3D; 1000;</span><br><span class="line">Date begin &#x3D; newDate();</span><br><span class="line">ByteBuffer buffer &#x3D; ByteBuffer.allocate(2*time);</span><br><span class="line">for(int i&#x3D;0;i&lt;time;i++)&#123;</span><br><span class="line">    buffer.putChar(&#39;a&#39;);</span><br><span class="line">&#125;</span><br><span class="line">buffer.flip();</span><br><span class="line">for(int i&#x3D;0;i&lt;time;i++)&#123;</span><br><span class="line">    buffer.getChar();</span><br><span class="line">&#125;</span><br><span class="line">Dateend &#x3D; newDate();</span><br><span class="line">System.out.println(end.getTime()-begin.getTime());</span><br><span class="line">begin &#x3D; newDate();</span><br><span class="line">ByteBuffer buffer2 &#x3D; ByteBuffer.allocateDirect(2*time);</span><br><span class="line">for(int i&#x3D;0;i&lt;time;i++)&#123;</span><br><span class="line">    buffer2.putChar(&#39;a&#39;);</span><br><span class="line">&#125;</span><br><span class="line">buffer2.flip();</span><br><span class="line">for(int i&#x3D;0;i&lt;time;i++)&#123;</span><br><span class="line">    buffer2.getChar();</span><br><span class="line">&#125;</span><br><span class="line">end &#x3D; newDate();</span><br><span class="line">System.out.println(end.getTime()-begin.getTime());</span><br></pre></td></tr></table></figure>

<p>测试的结果如下：</p>
<p><img src="./2019-07-22_java_nio_Java%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98%E4%B8%8E%E9%9D%9E%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/2.png"></p>
<p>可以看到直接内存在直接的IO操作上，还是有明显的差异的！</p>
<p>  作者：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/xing901022">xingoo</a></p>
<p>  出处：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/xing901022">http://www.cnblogs.com/xing901022</a></p>

        
<script src="/js/qrious.min.js"></script>


        <hr>
        <div>
            
            <p>
                <span>专题: </span>
                
                <a href="/series/#Java NIO">
                    <code key="Java NIO" class="post-label">Java NIO</code>
                </a>
                
            </p>
            
            <p>
                <span>本文发表于 2019-07-22，最后修改于 2020-11-25。</span>
            </p>
            <!-- 文章末尾的提示 start -->
            
            
            
                
            <!-- 文章末尾的提示 end -->
        </div>
        <hr />
        <p name="pagination" style="font-size: 1.2em">
    
    <a class="float-left" href="/post/java/advance/2019-05-04_java_labmda.html">上一篇 « Java8新特性学习-函数式编程</a>
    
    
    <a class="float-right" href="/post/java/advance/2019-07-22_java_stack.html">下一篇 » JVM内存结构：堆、栈、方法区</a>
    
</p>
    </article>
    <!-- 赞赏 -->
    <!--打赏-->

    <!-- 推荐阅读三篇文章 -->
    <div class="col-xs-12">
        <h3>推荐阅读</h3>
        
        <div class="post-preview">
    <div class="post-img" style="background-image: url('/images/java/basic/java_logo.png')"></div>
    <div class="post-info">
        <div class="post-info-center">
            <div class="hidden-xs">
                
                
                <span>/</span>
                
                <a class="text-gray" href="/tags/#Java"
                    title="Java">Java</a>
                <span>/</span>
                
                <a class="text-gray" href="/tags/#二进制"
                    title="二进制">二进制</a>
                <span>/</span>
                
                <a class="text-gray" href="/tags/#反码"
                    title="反码">反码</a>
                <span>/</span>
                
                <a class="text-gray" href="/tags/#补码"
                    title="补码">补码</a>
                <span>/</span>
                
                
            </div>
            <a href="/post/java/advance/2017-04-18_java_0xff.html" class="title">
                为什么要与上0xff（&0xff），有什么意义？
            </a>
            <p class="text-gray">
                <small>
                    <span>发表于2017-04-18，</span>
                    <span class="hidden-xs">全文2003字，</span>
                    <span>阅读约7分钟</span>
                </small>
            </p>
        </div>
    </div>
</div>
        
        <div class="post-preview">
    <div class="post-img" style="background-image: url('/images/java/io.png')"></div>
    <div class="post-info">
        <div class="post-info-center">
            <div class="hidden-xs">
                
                
                <span>/</span>
                
                <a class="text-gray" href="/tags/#Java"
                    title="Java">Java</a>
                <span>/</span>
                
                <a class="text-gray" href="/tags/#IO"
                    title="IO">IO</a>
                <span>/</span>
                
                
            </div>
            <a href="/post/java/io/2017-04-15_java_io_1_overview.html" class="title">
                Java IO(1) Overview
            </a>
            <p class="text-gray">
                <small>
                    <span>发表于2017-04-15，</span>
                    <span class="hidden-xs">全文384字，</span>
                    <span>阅读约2分钟</span>
                </small>
            </p>
        </div>
    </div>
</div>
        
        <div class="post-preview">
    <div class="post-img" style="background-image: url('/images/java/basic/java_logo.png')"></div>
    <div class="post-info">
        <div class="post-info-center">
            <div class="hidden-xs">
                
                
                <span>/</span>
                
                <a class="text-gray" href="/tags/#Java"
                    title="Java">Java</a>
                <span>/</span>
                
                <a class="text-gray" href="/tags/#书籍推荐"
                    title="书籍推荐">书籍推荐</a>
                <span>/</span>
                
                
            </div>
            <a href="/post/java/advance/2016-12-09_java_books.html" class="title">
                Java书籍推荐
            </a>
            <p class="text-gray">
                <small>
                    <span>发表于2016-12-09，</span>
                    <span class="hidden-xs">全文429字，</span>
                    <span>阅读约2分钟</span>
                </small>
            </p>
        </div>
    </div>
</div>
        
    </div>
    <div class="col-xs-12">
        <!-- 标签列表 -->
        <!-- Featured Tags -->
<style>
    #featured-tag .post-tag-item {
        font-size: 12px;
        line-height: 30px;
        display: inline-block;
        height: 30px;
        margin: 5px 0px;
        padding: 0 7px;
        color: #333;
        border-radius: 15px;
        background: #f6f6f6;
    }

    #featured-tag .post-tag-item:hover {
        color: #337ab7;
    }
</style>
<div id="featured-tag">
    
    <a class="post-tag-item" href="/tags/#关于我" title="关于我"
        rel="1">#关于我 (1) </a>
    
    <a class="post-tag-item" href="/tags/#Hello World" title="Hello World"
        rel="1">#Hello World (1) </a>
    
    <a class="post-tag-item" href="/tags/#Idea" title="Idea"
        rel="1">#Idea (1) </a>
    
    <a class="post-tag-item" href="/tags/#JavaIDE" title="JavaIDE"
        rel="1">#JavaIDE (1) </a>
    
    <a class="post-tag-item" href="/tags/#Java" title="Java"
        rel="43">#Java (43) </a>
    
    <a class="post-tag-item" href="/tags/#二进制" title="二进制"
        rel="2">#二进制 (2) </a>
    
    <a class="post-tag-item" href="/tags/#内存分配" title="内存分配"
        rel="1">#内存分配 (1) </a>
    
    <a class="post-tag-item" href="/tags/#内存泄露" title="内存泄露"
        rel="1">#内存泄露 (1) </a>
    
    <a class="post-tag-item" href="/tags/#书籍推荐" title="书籍推荐"
        rel="1">#书籍推荐 (1) </a>
    
    <a class="post-tag-item" href="/tags/#知识体系" title="知识体系"
        rel="1">#知识体系 (1) </a>
    
    <a class="post-tag-item" href="/tags/#反码" title="反码"
        rel="1">#反码 (1) </a>
    
    <a class="post-tag-item" href="/tags/#补码" title="补码"
        rel="1">#补码 (1) </a>
    
    <a class="post-tag-item" href="/tags/#内存模型" title="内存模型"
        rel="1">#内存模型 (1) </a>
    
    <a class="post-tag-item" href="/tags/#jvm" title="jvm"
        rel="3">#jvm (3) </a>
    
    <a class="post-tag-item" href="/tags/#性能优化" title="性能优化"
        rel="1">#性能优化 (1) </a>
    
    <a class="post-tag-item" href="/tags/#HashMap" title="HashMap"
        rel="1">#HashMap (1) </a>
    
    <a class="post-tag-item" href="/tags/#Java集合" title="Java集合"
        rel="1">#Java集合 (1) </a>
    
    <a class="post-tag-item" href="/tags/#ThreadLocal" title="ThreadLocal"
        rel="1">#ThreadLocal (1) </a>
    
    <a class="post-tag-item" href="/tags/#Java线程" title="Java线程"
        rel="3">#Java线程 (3) </a>
    
    <a class="post-tag-item" href="/tags/#异常" title="异常"
        rel="1">#异常 (1) </a>
    
    <a class="post-tag-item" href="/tags/#Java异常" title="Java异常"
        rel="1">#Java异常 (1) </a>
    
    <a class="post-tag-item" href="/tags/#思维导图" title="思维导图"
        rel="2">#思维导图 (2) </a>
    
    <a class="post-tag-item" href="/tags/#垃圾回收" title="垃圾回收"
        rel="2">#垃圾回收 (2) </a>
    
    <a class="post-tag-item" href="/tags/#Java引用" title="Java引用"
        rel="1">#Java引用 (1) </a>
    
    <a class="post-tag-item" href="/tags/#IO" title="IO"
        rel="6">#IO (6) </a>
    
    <a class="post-tag-item" href="/tags/#Exception" title="Exception"
        rel="1">#Exception (1) </a>
    
    <a class="post-tag-item" href="/tags/#Stream" title="Stream"
        rel="1">#Stream (1) </a>
    
    <a class="post-tag-item" href="/tags/#Netty" title="Netty"
        rel="4">#Netty (4) </a>
    
    <a class="post-tag-item" href="/tags/#笔记" title="笔记"
        rel="1">#笔记 (1) </a>
    
    <a class="post-tag-item" href="/tags/#NIO" title="NIO"
        rel="7">#NIO (7) </a>
    
    <a class="post-tag-item" href="/tags/#Buffer" title="Buffer"
        rel="1">#Buffer (1) </a>
    
    <a class="post-tag-item" href="/tags/#Selector" title="Selector"
        rel="1">#Selector (1) </a>
    
    <a class="post-tag-item" href="/tags/#问题" title="问题"
        rel="2">#问题 (2) </a>
    
    <a class="post-tag-item" href="/tags/#直接内存" title="直接内存"
        rel="1">#直接内存 (1) </a>
    
    <a class="post-tag-item" href="/tags/#非直接内存" title="非直接内存"
        rel="1">#非直接内存 (1) </a>
    
    <a class="post-tag-item" href="/tags/#堆内存" title="堆内存"
        rel="1">#堆内存 (1) </a>
    
    <a class="post-tag-item" href="/tags/#注解" title="注解"
        rel="1">#注解 (1) </a>
    
    <a class="post-tag-item" href="/tags/#Spring" title="Spring"
        rel="5">#Spring (5) </a>
    
    <a class="post-tag-item" href="/tags/#文件加载" title="文件加载"
        rel="1">#文件加载 (1) </a>
    
    <a class="post-tag-item" href="/tags/#Spring Boot" title="Spring Boot"
        rel="3">#Spring Boot (3) </a>
    
    <a class="post-tag-item" href="/tags/#Spring Cloud" title="Spring Cloud"
        rel="1">#Spring Cloud (1) </a>
    
    <a class="post-tag-item" href="/tags/#序列化" title="序列化"
        rel="1">#序列化 (1) </a>
    
    <a class="post-tag-item" href="/tags/#函数式编程" title="函数式编程"
        rel="1">#函数式编程 (1) </a>
    
    <a class="post-tag-item" href="/tags/#lambda" title="lambda"
        rel="1">#lambda (1) </a>
    
    <a class="post-tag-item" href="/tags/#并发编程" title="并发编程"
        rel="1">#并发编程 (1) </a>
    
    <a class="post-tag-item" href="/tags/#JUC" title="JUC"
        rel="1">#JUC (1) </a>
    
    <a class="post-tag-item" href="/tags/#lambda表达式" title="lambda表达式"
        rel="1">#lambda表达式 (1) </a>
    
    <a class="post-tag-item" href="/tags/#源码" title="源码"
        rel="1">#源码 (1) </a>
    
    <a class="post-tag-item" href="/tags/#RPC" title="RPC"
        rel="1">#RPC (1) </a>
    
    <a class="post-tag-item" href="/tags/#Reactor" title="Reactor"
        rel="1">#Reactor (1) </a>
    
    <a class="post-tag-item" href="/tags/#NIO模型" title="NIO模型"
        rel="1">#NIO模型 (1) </a>
    
    <a class="post-tag-item" href="/tags/#操作系统" title="操作系统"
        rel="1">#操作系统 (1) </a>
    
    <a class="post-tag-item" href="/tags/#微服务" title="微服务"
        rel="1">#微服务 (1) </a>
    
    <a class="post-tag-item" href="/tags/#Vert.x" title="Vert.x"
        rel="1">#Vert.x (1) </a>
    
    <a class="post-tag-item" href="/tags/#八皇后" title="八皇后"
        rel="1">#八皇后 (1) </a>
    
    <a class="post-tag-item" href="/tags/#算法" title="算法"
        rel="1">#算法 (1) </a>
    
</div>
    </div>
    <!-- 评论 -->
    
    <div class="col-xs-12">
        
<div class="col-xs-12 padding-0">
    <div id="gitalk-container">
        <div class="gt-container text-center" style="margin-top: 50px;">
            <button class="gt-btn gt-btn-public"><span class="gt-btn-text">去 Github 评论</span></button>
        </div>
    </div>
    <div id="gitalk-related"></div>
</div>

<link rel="stylesheet" href="/css/gitalk.css">


<script src="/js/gitalk.min.js"></script>

<script>
    window.addEventListener('load', function () {
        function renderCommentUrl(data) {
            var url = (data[window.location.pathname] || {}).url
            url && getDom('#gitalk-container button').addEventListener('click', function (e) { window.open(url)})
            url || (getDom('#gitalk-container').style.display = 'none')
        }
        const gitalk = new Gitalk({
            clientID: 'a33ab8f0fc90bd0b86d7',
            clientSecret: 'cfa4b020ca99ef91be8f4bf8180afbe831bf2a75',
            accessToken: '',
            repo: 'blogcmt',
            owner: 'HassanChiang',
            admin: ['HassanChiang'],
            id: window.location.pathname,
            distractionFreeMode: false
        });
        fetch("https://api.github.com/user").then(function(resp){
            gitalk.render('gitalk-container');
        }).catch(function(e){
            fetch('/tool/issues.json').then(function (r) { return r.json() }).then(renderCommentUrl).catch(function (e) { })
        })
        getDom('#gitalk-container').addEventListener('click', function (e) {
            e && e.stopPropagation && e.stopPropagation();
        });
    })
</script>
<script>
    window.addEventListener('load', function () {
        function render(comments) {
            var template = '<a href="${comment.url}?utm_source=gitalk" class="dis-item-url"><h3 class="dis-item-title">${comment.title}</h3>' +
                '<p class="dis-item-des">${comment.count} 评论 ● ${comment.date}</p>' +
                '<div class="dis-item-content"><img class="dis-item-img" src="${comment.icon}" alt="icon"><p><b><span class="dis-item-user">${comment.user}</span></b>&nbsp;——&nbsp;${comment.body}</p></div>' +
                '</a>'

            var wrapper = getDom('#gitalk-related');
            comments = shuffle(comments);
            comments.slice(0, 4).forEach(function (c) {
                var div = document.createElement('div');
                div.classList.add('dis-item');
                div.innerHTML = template.replace("${comment.url}", c.url)
                    .replace("${comment.title}", c.title)
                    .replace("${comment.count}", c.count)
                    .replace("${comment.date}", c.date)
                    .replace("${comment.icon}", c.icon)
                    .replace("${comment.user}", c.user)
                    .replace("${comment.body}", c.body)
                wrapper.appendChild(div)
            })
            var p = document.createElement('p')
            p.innerHTML = '<a target="_blank" rel="noopener" href="https://geektutu.com/post/blog-experience-7.html">Gitalk Plus</a>';
            p.classList.add('dis-divide');
            wrapper.appendChild(p);
            wrapper.classList.add('dis-wrapper')
        }
        function shuffle(a) {
            for (var i = a.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }
        fetch('/tool/comments.json').then(function (r) { return r.json() }).then(render).catch(function (e) { })
    })
</script>

    </div>
    
</div>
<aside class="float-left gkt-sidebar hidden-xs hidden-sm">
    <div style="clear: both"></div>
    <div class="gkt-sidebar-wrapper">
        <section class="box-shadow"><style>
    .gkt-summary {
        border: 1px solid #DDDDDD;
        border-radius: 3px;
        padding: 5px;
        width: 100%;
    }


    .gkt-summary nav {
        overflow: hidden;
    }

    .gkt-summary nav a {
        display: inline-block;
        text-align: center;
        color: #333;
        font-size: 12px;
    }

    .gkt-summary nav span {
        display: block;
    }

    .gkt-summary nav .middle {
        border-left: 1px solid #eaecef;
        border-right: 1px solid #eaecef;
    }

    .gkt-summary .number {
        font-weight: bold;
    }

    .gkt-summary .link-list {
        margin-top: 5px;
        margin-bottom: -5px;
        padding-top: 7px;
        border-top: 1px dashed #999;
        display: flex;
    }

    .gkt-summary .link-list a {
        flex: 1;
    }

    .gkt-summary .link-list img {
        width: 25px;
        height: 25px;
    }
</style>

<div class="gkt-summary">
    <nav>
        <a href="/" class="col-xs-4">
            <span class="number">47</span><span>文章</span>
        </a>
        <a href="/series" class="col-xs-4 middle">
            <span class="number">9</span><span>专题</span>
        </a>
        <a href="/tags" class="col-xs-4">
            <span class="number">56</span><span>标签</span>
        </a>
    </nav>

    
</div></section>
        
        
        <section class="gkt-sidebar-content box-shadow">
            <strong>Java NIO</strong>
            <ul>
                
                <li>
                    <a href="/post/java/nio/2017-04-21_java_nio_1.html"
                        class="">Java NIO (1) 基本概念</a>
                    
                </li>
                
                <li>
                    <a href="/post/java/nio/2017-04-22_java_nio_2.html"
                        class="">Java NIO(2) Buffer</a>
                    
                </li>
                
                <li>
                    <a href="/post/java/nio/2017-04-23_java_nio_3.html"
                        class="">Java NIO(3) 选择器 Selector</a>
                    
                </li>
                
                <li>
                    <a href="/post/java/nio/2019-02-27_java_nio_model.html"
                        class="">谈一谈 Java IO 模型</a>
                    
                </li>
                
                <li>
                    <a href="/post/java/nio/2019-04-07_java_nio_debug.html"
                        class="">Java NIO客户端主动关闭连接，导致服务器空轮询</a>
                    
                </li>
                
                <li>
                    <a href="/post/java/nio/2019-04-07_java_nio_使用注意点.html"
                        class="">NIO 各种使用注意点</a>
                    
                </li>
                
                <li>
                    <a href="/post/java/nio/2019-07-22_java_nio_Java直接内存与非直接内存性能测试.html"
                        class="gkt-sidebar-active">Java直接内存与非直接内存性能测试</a>
                    
                    <!-- Table of Contents -->
<div id="sidebar-toc">
  <!-- TOC  -->
  
  
  <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98%E4%B8%8E%E9%9D%9E%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98"><span class="toc-nav-text">什么是直接内存与非直接内存</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-nav-text">使用场景</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E7%94%B3%E8%AF%B7%E5%88%86%E9%85%8D%E5%9C%B0%E5%9D%80%E9%80%9F%E5%BA%A6%E6%AF%94%E8%BE%83"><span class="toc-nav-text">申请分配地址速度比较</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E8%AF%BB%E5%86%99%E9%80%9F%E5%BA%A6%E6%AF%94%E8%BE%83"><span class="toc-nav-text">读写速度比较</span></a></li></ol>
  
</div>

<script>
  (function () {
    var h2 = document.querySelectorAll('article h2');
    var h3 = document.querySelectorAll('article h3');
    var linkList = document.querySelectorAll('#sidebar-toc a');

    function findLinkElement(name) {
      for (var i = 0; i < linkList.length; i++) {
        var items = linkList[i].href.split('#');
        if (items && items[items.length - 1] === encodeURIComponent(name)) {
          return i;
        }
      }
      return -1;
    }

    function activeLink(titleList) {
      var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
      for (var i = titleList.length - 1; i >= 0; i--) {
        if (scrollTop - titleList[i].offsetTop > 0) {
          var index = findLinkElement(titleList[i].id);
          index != -1 && linkList[index].classList.add('gkt-sidebar-active');
          break;
        }
      }
    }

    window.addEventListener("scroll", function (e) {
      [].slice.call(linkList).forEach(function (link) {
        link.classList.remove('gkt-sidebar-active');
      })
      activeLink(h2);
    })
  })();
</script>
                    
                </li>
                
            </ul>
        </section>
        
        
        <section class="gkt-sidebar-content box-shadow">
            <strong>最近的文章</strong>
            <ul>
                
                <li>
                    <a href="/post/java/spring/2020-09-02_How to learn Spring Cloud – the practical way.html">How to learn Spring Cloud – the practical way</a>
                </li>
                
                <li>
                    <a href="/post/java/advance/2020-06-28_java_jvm.html">深入理解JVM-内存模型（jmm）和GC</a>
                </li>
                
                <li>
                    <a href="/post/java/netty/2020-05-26_Netty 知识点思维导图.html">Netty 知识点思维导图</a>
                </li>
                
            </ul>
        </section>
        
    </div>
</aside>

<script>
    (function () {
        function resizeUArrow() {
            var s = getDom('.u-arrow-wrapper').style
            var pc = getDom('.post-container')
            s.left = getPosition(pc).x + 'px';
            s.width = pc.clientWidth + 'px';
        }
        resizeUArrow()
        window.addEventListener('resize', resizeUArrow);
    })();
</script>

    

<script>
    (function () {
        var ele = getDom('.gkt-sidebar-content')
        if(!ele) return;
        var wrapper = getDom('.gkt-sidebar-wrapper')
        var last = 0
        ele.style.maxHeight = ((window.innerHeight || 798) - 200) + 'px'
        var f = function (e) {
            var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
            var isDown = scrollTop > last;
            var pos = getPosition(ele).y - scrollTop;
            var downLimit = 50;
            var upLimit = -100;
            // uarrow.style.marginTop = scrollTop + 'px';
            isDown && pos <= downLimit && wrapper.classList.add("gkt-sidebar-fixed");
            !isDown && pos > upLimit && wrapper.classList.remove("gkt-sidebar-fixed");
            last = scrollTop
        }
        f()
        window.addEventListener("scroll", f)
    })();
</script>

</main>
    </div>
    <style>
    img#go-top {
        position: fixed;
        bottom: 100px;
        width: 50px;
        cursor: pointer;
        z-index: 9999;
    }
</style>
<img id="go-top" src="/icon/top.png" class="hidden-xs" style="display: none" />
<script>
    (function () {
        var goTop = document.getElementById('go-top');
        var mainContainer = document.querySelector('.main-container');
        
        goTop.addEventListener('click', function () {
            window.scroll(0, 0);
        }, false);
        window.addEventListener('scroll', function () {
            var right = document.body.offsetWidth - mainContainer.getBoundingClientRect().right;
            var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
            goTop.style.right = right + 10 + 'px'
            scrollTop > 700 && (goTop.style.display = "block");
            scrollTop <= 700 && (goTop.style.display = "none");
        });
    })();
</script>
    <style>
    #geektutu-click-img-container {
        position: fixed;
        left: 0;
        top: 0;
        text-align: center;
        width: 100%;
        display: none;
        z-index: 9999;
    }

    #geektutu-click-img-container img {
        object-fit: contain;
        background: #eaecef;
        padding: 15px;
        border-radius: 10px;
        height: auto;
        width: auto;
        vertical-align: middle;
    }
</style>


<div id="geektutu-click-img-container">
    <img src="" alt="Big Image">
</div>

<script>
    (function () {
        var container = document.querySelector('#geektutu-click-img-container')
        var targetImg = container.querySelector('img')
        var imgs = document.querySelectorAll('article img');
        targetImg.addEventListener('click', function (e) {
            container.style.display = 'none';
            e && e.stopPropagation && e.stopPropagation();
        }, false);

        for (var i = 0; i < imgs.length; ++i) {
            var img = imgs[i];
            img.addEventListener('click', (function (src, rate) {
                return function (e) {
                    e && e.stopPropagation && e.stopPropagation();
                    if (window.innerWidth < 980) {
                        return
                    }
                    targetImg.style.height = targetImg.style.width = 'auto';
                    if (window.innerWidth / window.innerHeight > rate) {
                        targetImg.style.height = (window.innerHeight - 20) + 'px';
                    } else {
                        targetImg.style.width = (window.innerWidth - 20) + 'px';
                    }
                    container.style.height = window.innerHeight + 'px'
                    container.style.lineHeight = window.innerHeight + 'px'
                    container.style.display = 'block';
                    targetImg.src = src;
                };
            }(img.src, img.width / img.height)), false)
        }
    })();
</script>
    <!-- Footer -->
    <!-- Footer -->
<style>
    footer {
        width: 100%;
        line-height: 1.5;
        padding: 20px;
    }

    footer a {
        color: #333;
        text-decoration: none;
    }

    .footer-hexo img {
        height: 20px;
        margin-bottom: -5px;
    }

    .footer-hexo a {
        color: #337ab7;
    }
</style>
<footer class="text-center col-xs-12">
    <p>
        <small>© 2020 - Hassan - </small>
        <small>
            <a target="_blank" rel="nofollow noopener" href="http://beian.miit.gov.cn/"></a>
        </small>
    </p>
    <p class="footer-hexo">
        <!-- 但若直接使用或修改主题，请务必保留这段声明 -->
        <small>Powered by <a target="_blank" href="https://hexo.io">Hexo</a> | Theme
            <a target="_blank" href="https://geektutu.com">Geektutu</a>
            <a target="_blank" rel="noopener" href="https://github.com/geektutu/hexo-theme-geektutu">
                <img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAYGBgYHBgcICAcKCwoLCg8ODAwODxYQERAREBYiFRkVFRkVIh4kHhweJB42KiYmKjY+NDI0PkxERExfWl98fKcBBgYGBgcGBwgIBwoLCgsKDw4MDA4PFhAREBEQFiIVGRUVGRUiHiQeHB4kHjYqJiYqNj40MjQ+TERETF9aX3x8p//CABEIACIAUAMBIgACEQEDEQH/xAAcAAABBAMBAAAAAAAAAAAAAAAAAQQFBwIDBgj/2gAIAQEAAAAA9KrHSgAYL5/z6zZGuJd12uugbhq3uKtmuRtix20IS7lTLAfAAAn/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oACAECEAAAAAAB/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAgBAxAAAAAAAf/EADEQAAICAQIEBQEGBwAAAAAAAAECAwQFAAYREhORBxQhUlQxQVFic5KxJDJCYYGC0f/aAAgBAQABPwCFHnjWUzuvN6hV4cANSRLGjO9yRVUcSzMoA7jVXJYe5N0a2dhmk9kc0bN2GvLN8mbuNeWb5M3ca8s3yZu415Y/Jm7jXlm+TN3H/NeVPyZu40vOk3TZywK8wJ+v3EHVM/wsI/Dq2lrxN3Nnca16eti8chSAIoMbzByhMwP14kHVfwIiSaF5c96J6kwwCOTnHsYk8uvCrdmQy1TI4rJuz3cZLyGR/wCd4+YoOf8AEpUjXitubLYPG4paFsUxcuiGe7yc5gTW3LW44szXmobsi3Dhmic2+Z4+vCVH9CpraPiQ+QvbgTJrPFBWd5YpWrmNIIEXiRO32Pqt4p7cnfHk18lFBdmEVW1LVdIZGOrniTt6plrWKaO69yCykDRxwF+LMAewB0Txtr+Sf31VI8tEPw62fZt7N3Humtbpzz13ucX6CGSWMSuzpLyD1eNgeUka3PuvHbaxq3biTMHfkiSNCS78CwU+3Xg7Vu3MhuTcU6cq3Zemn3Eh2dv8Lzcut+29x1atKbHYqLJUhLwyNMwiZ3j9yDWOxUOV3tgb+3No5LDx1pi9+aeIwRlNY6bc+Jv+IFGrhLxtXJZ7VKcw81diiAAEn0JOrkWZyNfbEr0tz27UGQgkuGzXdIIvyowq99bRxk9ffO/L81SZBPZgEEroQroIxxMZOgeNsfkn99QypHGqO4Vl9CDrN4LDZkwyzyyQ2IgRHZrzGCZVP1XnQglT9oOtw4LC7iqV6uRkZoYpxKFSQpzFRw4EjVRMfSrQ1qqwxQxKFjjTgFUD7BoWYR6iVe+mtxt9Zwf9teaj4AdccPu5tedX5A/VrzUR+sy/q1CwksF19VEfDj/cnQRW+qg66cfsXtrpx+xe2unH7F7a6cfsXtrpx+xe2unH7F7a6cfsXtoxx+xe2gAAOA1//8QAFBEBAAAAAAAAAAAAAAAAAAAAMP/aAAgBAgEBPwB//8QAFBEBAAAAAAAAAAAAAAAAAAAAMP/aAAgBAwEBPwB//9k="
                    alt="Github Star">
            </a>
        </small>
    </p>
    
    <p>
        <small>
            <span id="busuanzi_container_site_pv">👁<span id="busuanzi_value_site_pv"></span></span> &nbsp;
            <span id="busuanzi_container_page_pv">📚<span id="busuanzi_value_page_pv"></span></span>
        </small>
    </p>
    
    

</footer>


<script>
    window.addEventListener('load', function () {
        globalAddScript('//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js');
    })
</script>

<!-- Baidu Tongji -->





    <script>
        // 非本站网址，新开tab页签
        (function () {
            var stopBubble = function (e) {
                e && e.stopPropagation && e.stopPropagation();
            }
            var links = document.querySelectorAll('a');
            [].slice.call(links).forEach(function (item) {
                if (item.href && item.href.indexOf(window.location.host) === -1) {
                    item.target = '_blank'
                }
                // 阻止冒泡，不触发彩蛋。
                item.addEventListener('click', stopBubble, false);
            });
            var article = document.querySelector('article');
            article && article.addEventListener('click', stopBubble, false)
        })();
    </script>
    
<script>
    (function (window, document, undefined) {
        var hearts = [];
        var keywords = ["点个赞", "留个言", "赞赏一下", "分享之", "blog.fenxiangz.com"];
        function randomInt(max) {
            return Math.floor(Math.random() * Math.floor(max));
        }
        window.addEventListener('click', createWord)

        function createWord(e) {
            var d = document.createElement("span");
            d.style.position = 'fixed';
            d.style.zIndex = 9999;
            d.style.color = 'rgb(' + [randomInt(255), randomInt(255), randomInt(255)].join(',') + ')';
            d.innerHTML = keywords[randomInt(keywords.length)];
            d.onselectstart = function () { return false; }

            hearts.push({ el: d, x: e.clientX - 5, y: e.clientY - 5, alpha: 1, scale: 1 });
            document.body.appendChild(d);
        }
        (function gameloop() {
            for (var i = 0; i < hearts.length; i++) {
                heart = hearts[i];
                if (heart.alpha <= 0) {
                    document.body.removeChild(heart.el);
                    hearts.splice(i, 1);
                    continue;
                }
                heart.y -= heart.alpha < 0.5 ? 2 : 1;
                heart.scale += 0.002;
                heart.alpha -= 0.013;
                heart.el.style.transform = 'scale(' + heart.scale + ')';
                heart.el.style.left = heart.x + 'px';
                heart.el.style.top = heart.y + 'px';
            }
            setTimeout(gameloop, 10)
        })();
    })(window, document);
</script>

</body>

</html>